---
title: DNS原理及其解析过程
tags:
  - 广告
categories:
  - 项目总结
toc: false
date: 2018-01-11 16:12:49
---

## 什么是DNS？ 
DNS( Domain Name System)是“域名系统”的英文缩写，是一种组织成域层次结构的计算机和网络服务命名系统，它用于TCP/IP网络，它所提供的服务是用来将主机名和域名转换为IP地址的工作。DNS就是这样的一位“翻译官”。 

![DNS的作用](http://houjiyi.oss-cn-beijing.aliyuncs.com/images/blog/DNS%E8%A7%A3%E6%9E%90%E5%8E%9F%E7%90%86/1.jpg)

<!-- more -->

## 域的划分
域名系统作为一个层次结构和分布式数据库，包含各种类型的数据，包括主机名和域名。DNS数据库中的名称形成一个分层树状结构称为域命名空间。域名包含单个标签分隔点，例如：im.qq.com。 

完全限定的域名 (FQDN) 唯一地标识在 DNS 分层树中的主机的位置，通过指定的路径中点分隔从根引用的主机的名称列表。 

![](http://houjiyi.oss-cn-beijing.aliyuncs.com/images/blog/DNS%E8%A7%A3%E6%9E%90%E5%8E%9F%E7%90%86/2.jpg)

按其功能命名空间中用来描述 DNS 域名称的五个类别的介绍详见下表中，以及与每个名称类型的示例。 

![](http://houjiyi.oss-cn-beijing.aliyuncs.com/images/blog/DNS%E8%A7%A3%E6%9E%90%E5%8E%9F%E7%90%86/3.jpg)

### 根域
就是所谓的“.”，其实我们的网址www.qq.com在配置当中应该是www.baidu.com.（最后有一点），一般我们在浏览器里输入时会省略后面的点。根域服务器我们知道有13台，但是这是错误的观点。根域服务器只是具有13个IP地址，但机器数量却不是13台，因为这些IP地址借助了任播的技术，所以我们可以在全球设立这些IP的镜像站点，你访问到的这个IP并不是唯一的那台主机。 

### 顶级域
根域下来就是顶级域或者叫一级域。一些常见的DNS域名称如下图： 

![](http://houjiyi.oss-cn-beijing.aliyuncs.com/images/blog/DNS%E8%A7%A3%E6%9E%90%E5%8E%9F%E7%90%86/4.jpg)

### 域名服务器
每个域都会有域名服务器，也叫权威域名服务器。 

能提供域名解析的服务器，上面的记录类型可以是A(address)记录,NS记录（name server）,MX（mail）,CNAME等。 

### 资源记录 
DNS 数据库中包含的资源记录 (RR)。 每个 RR 标识数据库中的特定资源。我们在建立DNS服务器时，经常会用到SOA,NS,A之类的记录，在维护DNS服务器时，会用到MX，CNAME记录。

![](http://houjiyi.oss-cn-beijing.aliyuncs.com/images/blog/DNS%E8%A7%A3%E6%9E%90%E5%8E%9F%E7%90%86/5.jpg)

## DNS服务的工作过程 
当 DNS 客户机需要查询程序中使用的名称时，它会查询本地DNS 服务器来解析该名称。客户机发送的每条查询消息都包括3条信息，以指定服务器应回答的问题。 

1. 指定的 DNS 域名，表示为完全合格的域名 (FQDN) 。 
2. 指定的查询类型，它可根据类型指定资源记录，或作为查询操作的专门类型。 
3。 DNS域名的指定类别。 

对于DNS 服务器，它始终应指定为 Internet 类别。例如，指定的名称可以是计算机的完全合格的域名，如im.qq.com，并且指定的查询类型用于通过该名称搜索地址资源记录。 

DNS 查询以各种不同的方式进行解析。客户机有时也可通过使用从以前查询获得的缓存信息就地应答查询。DNS 服务器可使用其自身的资源记录信息缓存来应答查询，也可代表请求客户机来查询或联系其他 DNS 服务器，以完全解析该名称，并随后将应答返回至客户机。这个过程称为递归。 

另外，客户机自己也可尝试联系其他的 DNS 服务器来解析名称。如果客户机这么做，它会使用基于服务器应答的独立和附加的查询，该过程称作迭代，即DNS服务器之间的交互查询就是迭代查询。

![](http://houjiyi.oss-cn-beijing.aliyuncs.com/images/blog/DNS%E8%A7%A3%E6%9E%90%E5%8E%9F%E7%90%86/6.jpg) 

1. 在浏览器中输入www.qq.com域名，操作系统会先检查自己本地的hosts文件是否有这个网址映射关系，如果有，就先调用这个IP地址映射，完成域名解析。 
2. 如果hosts里没有这个域名的映射，则查找本地DNS解析器缓存，是否有这个网址映射关系，如果有，直接返回，完成域名解析。 
3. 如果hosts与本地DNS解析器缓存都没有相应的网址映射关系，首先会找TCP/IP参数中设置的首选DNS服务器，在此我们叫它本地DNS服务器，此服务器收到查询时，如果要查询的域名，包含在本地配置区域资源中，则返回解析结果给客户机，完成域名解析，此解析具有权威性。 
4. 如果要查询的域名，不由本地DNS服务器区域解析，但该服务器已缓存了此网址映射关系，则调用这个IP地址映射，完成域名解析，此解析不具有权威性。 
5. 如果本地DNS服务器本地区域文件与缓存解析都失效，则根据本地DNS服务器的设置（是否设置转发器）进行查询，如果未用转发模式，本地DNS就把请求发至13台根DNS，根DNS服务器收到请求后会判断这个域名(.com)是谁来授权管理，并会返回一个负责该顶级域名(.com)服务器的一个IP。 
6. 本地DNS服务器收到IP信息后，将会联系负责.com域的这台服务器。这台负责.com域的服务器收到请求后，如果自己无法解析，它就会找一个管理.com域的下一级DNS服务器地址(qq.com)给本地DNS服务器。 
7. 当本地DNS服务器收到这个地址后，就会找qq.com域服务器，重复上面的动作，进行查询，直至找到www.qq.com主机。 
8. 如果用的是转发模式，此DNS服务器就会把请求转发至上一级DNS服务器，由上一级服务器进行解析，上一级服务器如果不能解析，或找根DNS或把转请求转至上上级，以此循环。不管是本地DNS服务器用是转发，还是根提示，最后都是把结果返回给本地DNS服务器，由此DNS服务器再返回给客户机。




[原文地址](http://blog.csdn.net/benbenzhuhwp/article/details/44704307)
